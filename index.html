<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monicare - Your Portable Dev Dashboard</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
    }
    #matrixCanvas {
      position: fixed;
      top: 0; left: 0; z-index: -1;
      width: 100%; height: 100%;
    }

    /* Modal base */
    .modal-container {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 100;
    }
    .modal-container.active {
      opacity: 1; pointer-events: all;
    }
    .modal-content {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 2rem;
      width: 90%; max-width: 500px;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    .modal-container.active .modal-content {
      transform: translateY(0);
    }

    /* Category badges */
    .category-btn.active {
      background-color: #10b981; color: #fff;
      transform: scale(1.05);
      box-shadow: 0 4px 14px rgba(16,185,129,0.4);
    }

    /* Password cards */
    .password-card {
      transition: all 0.3s ease-in-out;
    }
    .password-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    /* Expiration badges */
    .expiration-badge { position: absolute; top: -8px; right: -8px;
      width: 26px; height: 26px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: bold; z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .expiring-soon { background-color: #f59e0b; color: #fff; animation: pulse 2s infinite; }
    .expired        { background-color: #ef4444; color: #fff; }
    @keyframes pulse {
      0%   { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); }
      70%  { box-shadow: 0 0 0 10px rgba(245,158,11,0); }
      100% { box-shadow: 0 0 0 0 rgba(245,158,11,0); }
    }

    /* Toasts */
    .toast {
      position: fixed; bottom: 20px; right: 20px;
      background-color: #1e293b; color: #fff;
      padding: 12px 20px; border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: flex; align-items: center; gap: 10px;
      opacity: 0; transform: translateX(100%);
      transition: all 0.3s ease; z-index: 1000;
    }
    .toast.show { opacity: 1; transform: translateX(0); }
    .toast.hide { opacity: 0; transform: translateX(100%); }

    /* Screens */
    .screen {
      position: fixed; top:0; left:0; right:0; bottom:0;
      display:flex; align-items:center; justify-content:center;
      transition: opacity 0.5s ease; z-index:50;
    }
    .hidden-screen { opacity:0; pointer-events:none; }
    .visible-screen{ opacity:1; pointer-events:all; }

    /* Strength bar & health ring */
    .password-strength-bar {
      height:8px; border-radius:4px; margin-top:5px;
      transition: width .3s, background-color .3s;
    }
    .health-score-ring {
      stroke-dasharray:377; stroke-dashoffset:377;
      transition: stroke-dashoffset 1s ease;
    }
  </style>
</head>

<body class="dark bg-gray-900 text-gray-200">
  <!-- Matrix Background -->
  <canvas id="matrixCanvas"></canvas>

  <!-- 1. Loading Screen (UNCHANGED) -->
  <div id="loadingScreen" class="screen visible-screen">
    <div class="text-center">
      <div
        class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-green-500 mx-auto"
      ></div>
      <div class="text-lg mt-4 text-green-400">Initializing SecureVault...</div>
    </div>
  </div>

  <!-- 2. Login Screen (Layout preserved, App name updated) -->
  <div id="loginContainer" class="screen hidden-screen">
    <div
      class="bg-gray-800 p-8 md:p-10 rounded-xl shadow-lg w-full max-w-md backdrop-blur-sm bg-opacity-70 border border-gray-700"
    >
      <div class="text-center mb-8">
        <div class="text-green-400 text-6xl mb-4">
          <i class="fas fa-lock"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-50">Monicare</h1>
        <p class="text-gray-400 mt-2">Your portable dev dashboard</p>
      </div>
      <form id="loginForm">
        <div class="mb-6">
          <label
            for="masterPassword"
            class="block text-gray-300 text-sm font-medium mb-2"
            >Master Password</label
          >
          <div class="relative">
            <input
              type="password"
              id="masterPassword"
              placeholder="Enter your master password"
              required
              class="w-full px-4 py-3 pr-12 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-green-500 text-gray-200"
            />
            <button
              type="button"
              class="absolute inset-y-0 right-0 px-4 text-gray-400 hover:text-green-400"
              id="toggleMasterPassword"
            >
              <i class="fas fa-eye"></i>
            </button>
          </div>
        </div>
        <button
          type="submit"
          class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
        >
          <i class="fas fa-sign-in-alt mr-2"></i>Login
        </button>
      </form>
    </div>
  </div>

  <!-- 3. Main App Container -->
  <div id="appContainer" class="hidden min-h-screen">
    <header
      class="bg-gray-800 bg-opacity-80 backdrop-blur-md p-4 sm:p-6 flex flex-col sm:flex-row items-center justify-between shadow-lg sticky top-0 z-40"
    >
      <h1 class="text-2xl font-bold text-green-400 mb-4 sm:mb-0">
        <i class="fas fa-th-large mr-2"></i>Monicare
      </h1>

      <!-- Search / Controls -->
      <div class="flex items-center space-x-2 sm:space-x-4 w-full sm:w-auto">
        <div class="relative w-full sm:w-64">
          <input
            type="text"
            id="searchBox"
            placeholder="Search modules..."
            autocomplete="off"
            class="w-full bg-gray-700 text-gray-200 border border-gray-600 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-300"
          />
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
        <button
          id="launchPluginBtn"
          title="Load Plugin"
          class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-full transition duration-300 ease-in-out transform hover:scale-110"
        >
          <i class="fas fa-puzzle-piece"></i>
        </button>
        <div class="relative group">
          <button
            id="settingsBtn"
            title="Settings"
            class="bg-gray-700 hover:bg-gray-600 text-gray-300 p-3 rounded-full transition duration-300 ease-in-out transform hover:rotate-90"
          >
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <div
            id="settingsDropdown"
            class="absolute right-0 mt-2 w-48 bg-gray-700 rounded-lg shadow-xl py-2 z-50 hidden group-hover:block transition-all duration-300 origin-top-right scale-95 opacity-0 group-hover:scale-100 group-hover:opacity-100"
          >
            <a
              href="#"
              id="monicareLabsBtn"
              class="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 rounded-t-lg"
              ><i class="fas fa-flask mr-2"></i>Monicare Labs</a
            >
            <a
              href="#"
              id="changeMasterPasswordBtn"
              class="block px-4 py-2 text-sm text-gray-200 hover:bg-gray-600"
              ><i class="fas fa-key mr-2"></i>Change Master Password</a
            >
            <a
              href="#"
              id="logoutBtn"
              class="block px-4 py-2 text-sm text-red-400 hover:bg-gray-600 rounded-b-lg"
              ><i class="fas fa-sign-out-alt mr-2"></i>Logout</a
            >
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 pt-8">
      <!-- Category Filters -->
      <div class="flex flex-wrap gap-2 mb-6 justify-center sm:justify-start">
        <button
          class="category-btn bg-gray-700 text-gray-300 hover:bg-green-600 hover:text-white px-4 py-2 rounded-full transition duration-300 ease-in-out"
          data-category="all"
          >All</button
        >
        <button
          class="category-btn bg-gray-700 text-gray-300 hover:bg-green-600 hover:text-white px-4 py-2 rounded-full transition duration-300 ease-in-out"
          data-category="dev"
          >DevOps</button
        >
        <button
          class="category-btn bg-gray-700 text-gray-300 hover:bg-green px-4 py-2 rounded-full transition duration-300 ease-in-out"
          data-category="ssh"
          >SSH</button
        >
        <button
          class="category-btn bg-gray-700 text-gray-300 hover:bg-green-600 hover:text-white px-4 py-2 rounded-full transition duration-300 ease-in-out"
          data-category="vault"
          >Vault</button
        >
      </div>

      <!-- Module Cards -->
      <div
        id="modulesList"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      >
        <!-- Dynamically injected plugin cards -->
      </div>
    </main>
  </div>

  <!-- 4. Password/Module Modal -->
  <div id="moduleModal" class="modal-container">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-6">
        <h2 id="moduleModalTitle" class="text-2xl font-bold text-gray-50">
          Load Monicare Plugin
        </h2>
        <button
          id="closeModuleModal"
          class="text-gray-400 hover:text-green-500 transition duration-300"
        >
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      <form id="moduleForm" class="space-y-4">
        <div>
          <label
            for="pluginUrl"
            class="block text-sm font-medium text-gray-300"
            >Plugin URL</label
          >
          <input
            type="url"
            id="pluginUrl"
            placeholder="e.g. https://cdn.monicare/plugins/vault.module.js"
            required
            class="w-full px-4 py-2 rounded-lg bg-gray-700 border border-gray-600 focus:outline-none focus:border-green-500 text-gray-200 mt-1"
          />
        </div>
        <div class="flex justify-end space-x-4 mt-6">
          <button
            type="button"
            id="cancelModuleBtn"
            class="px-6 py-2 rounded-lg text-gray-300 hover:bg-gray-700 transition duration-300 ease-in-out"
          >
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
          <button
            type="submit"
            id="saveModuleBtn"
            class="px-6 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium transition duration-300 ease-in-out"
          >
            <i class="fas fa-download mr-2"></i>Load Plugin
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 5. Security Dashboard Modal -->
  <div id="securityModal" class="modal-container">
    <div class="modal-content" style="max-width: 700px;">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-50">
          Monicare Security Dashboard
        </h2>
        <button
          id="closeSecurityModal"
          class="text-gray-400 hover:text-green-500 transition duration-300"
        >
          <i class="fas fa-times text-2xl"></i>
        </button>
      </div>
      <div class="space-y-6">
        <p id="breachStatus" class="text-gray-400 text-center text-sm">
          All modules operational. No issues detected.
        </p>
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Health Score -->
          <div class="bg-gray-700 p-6 rounded-xl w-full md:w-1/3 text-center">
            <h3 class="text-lg font-semibold text-gray-200 mb-4">
              System Health Score
            </h3>
            <div class="relative w-32 h-32 mx-auto">
              <svg class="w-full h-full transform -rotate-90">
                <circle
                  class="text-gray-600"
                  stroke-width="8"
                  stroke="currentColor"
                  r="60"
                  cx="64"
                  cy="64"
                ></circle>
                <circle
                  id="healthScoreRing"
                  class="health-score-ring text-green-500"
                  stroke-width="8"
                  stroke-linecap="round"
                  stroke="currentColor"
                  r="60"
                  cx="64"
                  cy="64"
                  style="stroke-dashoffset:100;"
                ></circle>
              </svg>
              <span
                id="healthScoreText"
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-3xl font-bold text-green-400"
                >86</span
              >
            </div>
          </div>

          <!-- Insights -->
          <div class="bg-gray-700 p-6 rounded-xl w-full md:w-2/3">
            <h3 class="text-lg font-semibold text-gray-200 mb-4">
              Security Insights
            </h3>
            <div id="insightList" class="space-y-2">
              <div
                class="p-3 bg-green-800 bg-opacity-30 rounded-lg flex items-center space-x-3"
              >
                <i class="fas fa-check-circle text-green-400"></i>
                <p class="text-sm">All plugins loaded successfully</p>
              </div>
              <div
                class="p-3 bg-yellow-800 bg-opacity-30 rounded-lg flex items-center space-x-3"
              >
                <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                <p class="text-sm"><span class="font-bold">1</span> plugin update available</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 6. Toast container -->
  <div id="toastContainer"></div>

  <!-- 7. Core Scripts + Plugin Loader -->
  <script>
    // Matrix background init
    function initMatrixBackground(canvas) {
      const ctx = canvas.getContext('2d');
      const fontSize = 14;
      let columns, drops;

      const resize = () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        columns = Math.floor(canvas.width / fontSize);
        drops = Array(columns).fill(0).map(() => Math.random() * canvas.height);
      };
      window.addEventListener('resize', resize);
      resize();

      const chars =
        'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*()-_=+[]{}|;:,.<>/?';
      function draw() {
        ctx.fillStyle = 'rgba(0,0,0,0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0f0';
        ctx.font = `${fontSize}px monospace`;

        drops.forEach((y, i) => {
          const text = chars.charAt(Math.floor(Math.random() * chars.length));
          ctx.fillText(text, i * fontSize, y * fontSize);
          drops[i] = y * fontSize > canvas.height && Math.random() > 0.975 ? 0 : y + 1;
        });
        requestAnimationFrame(draw);
      }
      draw();
    }

    // Toast notifications
    function showToast(message, type = 'success') {
      const tC = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.classList.add('toast');
      let icon = '<i class="fas fa-check-circle text-green-400"></i>';
      if (type === 'error') icon = '<i class="fas fa-exclamation-circle text-red-400"></i>';
      if (type === 'warning')
        icon = '<i class="fas fa-exclamation-triangle text-yellow-400"></i>';
      toast.innerHTML = \`\${icon}<span class="flex-grow">\${message}</span>\`;
      tC.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        toast.classList.add('hide');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Screen visibility helpers
    function showScreen(id) {
      document.getElementById(id).classList.replace('hidden-screen', 'visible-screen');
    }
    function hideScreen(id) {
      document.getElementById(id).classList.replace('visible-screen', 'hidden-screen');
    }

    // Modal toggles
    function openModal(id) {
      document.getElementById(id).classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Monicare global & plugin registry
    window.Monicare = {
      plugins: {},
      registerPlugin(name, plugin) {
        this.plugins[name] = plugin;
        plugin.init && plugin.init(this);
        showToast(\`\${name} plugin registered\`, 'success');
      },
      loadPlugin(url) {
        return new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = url;
          s.onload = () => resolve(url);
          s.onerror = () => reject(url);
          document.head.appendChild(s);
        });
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      // 1. Start Matrix background
      initMatrixBackground(document.getElementById('matrixCanvas'));

      // 2. Simulated loading → login
      setTimeout(() => {
        hideScreen('loadingScreen');
        showScreen('loginContainer');
      }, 2000);

      // 3. Login form
      document.getElementById('loginForm').addEventListener('submit', (e) => {
        e.preventDefault();
        hideScreen('loginContainer');
        document.getElementById('appContainer').classList.remove('hidden');
        showToast('Login successful! Welcome to Monicare Guardian', 'success');
      });

      // 4. Settings & modals
      document.getElementById('settingsBtn').onclick = () => {}; // hover-based
      document.getElementById('logoutBtn').onclick = () => {
        document.getElementById('appContainer').classList.add('hidden');
        showScreen('loginContainer');
        showToast('You have been logged out', 'success');
      };

      // Module modal
      document.getElementById('launchPluginBtn').onclick = () => openModal('moduleModal');
      document.getElementById('closeModuleModal').onclick = () => closeModal('moduleModal');
      document.getElementById('cancelModuleBtn').onclick = () => closeModal('moduleModal');
      document.getElementById('moduleForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const url = document.getElementById('pluginUrl').value.trim();
        closeModal('moduleModal');
        try {
          await window.Monicare.loadPlugin(url);
        } catch {
          showToast(\`Failed to load \${url}\`, 'error');
        }
      });

      // Security dashboard
      document.getElementById('monicareLabsBtn').onclick = () => openModal('securityModal');
      document.getElementById('closeSecurityModal').onclick = () =>
        closeModal('securityModal');

      // Toggle master password visibility
      document.getElementById('toggleMasterPassword').onclick = function () {
        const inp = document.getElementById('masterPassword');
        const ic = this.querySelector('i');
        if (inp.type === 'password') {
          inp.type = 'text';
          ic.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
          inp.type = 'password';
          ic.classList.replace('fa-eye-slash', 'fa-eye');
        }
      };

      // Category filtering (placeholder)
      document.querySelectorAll('.category-btn').forEach((btn) =>
        btn.addEventListener('click', () => {
          document
            .querySelectorAll('.category-btn')
            .forEach((b) => b.classList.remove('active'));
          btn.classList.add('active');
          showToast(\`Filter: \${btn.textContent}\`, 'success');
          // TODO: filter modulesList based on data-category
        })
      );
    });
  </script>
</body>
</html>